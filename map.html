<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Visicom Example</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
</head>
<body>
<style type="text/css">
	#map{
  left: 0px;
  right: 0px;
  top:0;
  bottom: 0;
  position:absolute;
  z-index:1;
}
</style>
    <div id="map"></div>
    <script>

        var tileLayer;

        var map = new L.Map('map', {
            center: new L.LatLng(50.455002, 30.511284),
            zoom: 9,
            layers : [
            new L.TileLayer('http://tms{s}.visicom.ua/2.0.0/planet3/base_ru/{z}/{x}/{y}.png',{
                        maxZoom: 19,
                        tms : true,
                        attribution : 'Äàííûå êàðò © 2013 ×ÀÎ «<a href="http://visicom.ua/">Âèçèêîì</a>»',
                        subdomains : '123'
                })
            ]
        });

 var earthqkLayer;

$.ajax({
  dataType: 'json',
  url: '/earthquake',
 success: function (jsondata) {
 	earthqkLayer=L.geoJson(jsondata, {pointToLayer: function(feature, latlng){
 		return L.circleMarker(latlng, {
 			radius: feature.properties.mag*5,
 			fillColor: "red"
 		}
 			);
 	}
 		}
 		).addTo(map);
 	}
 	}
);

var MyControl = L.Control.extend({
    options: {
        position: 'topright'
    },

    onAdd: function (map) {
        
        var container = L.DomUtil.create('div', 'my-custom-control');
       container.style.backgroundColor = 'blue';
       container.style.width = '60px';
       container.style.height = '60px';
 
    container.onclick = function(){
      earthqkLayer.refresh('/earthquake');
    }
    return container;
    }
});

map.addControl(new MyControl());
    </script>
</body>
</html>
